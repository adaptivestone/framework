image: registry.gitlab.com/adaptivestone/ubuntu-node:latest

services:
  - redis:latest

stages:
  - install
  - codeStyle
  - test

install:
  stage: install
  script:
    - npm i
  artifacts:
    paths:
      - node_modules/
    expire_in: 10 day

prettier:
  stage: codeStyle
  script:
    - npm run codestyle

test:
  stage: test
  variables:
    LOGGER_CONSOLE_LEVEL: 'error'
    REDIS_PORT: 6379
    REDIS_HOST: redis
    REDIS_URL: redis://localhost:6379
  script:
    - npm test

sast:
  stage: test
include:
  - template: Security/SAST.gitlab-ci.yml
